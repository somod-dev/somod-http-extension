AWSTemplateFormatVersion: ${sq}2010-09-09${sq}
Transform: AWS::Serverless-2016-10-31
Globals:
  Function:
    Runtime: nodejs16.x
    Handler: index.default
    Architectures:
      - arm64
Resources:
  HttpApiGateway:
    Type: AWS::Serverless::HttpApi
    Properties:
      CorsConfiguration:
        AllowOrigins:
          - ${sq}*${sq}
  FunctionA:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: .somod/serverless/functions/moduleA/fnA
      Events:
        HttpApiEvent:
          Type: HttpApi
          Properties:
            Path: /user/{userId}
            Method: GET
            ApiId:
              Ref: r98a6ba03HttpApiGateway
      Layers:
        - Ref: sampleLayer
        - Ref: somod-http-extensionfnA
  FunctionB:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: .somod/serverless/functions/@test/moduleB/fnB
      Events:
        HttpApiEvent:
          Type: HttpApi
          Properties:
            Path: /user/{userId}
            Method: GET
            ApiId:
              Ref: r98a6ba03HttpApiGateway
      Layers:
        - Ref: sampleLayer
        - Ref: somod-http-extensionfnB
  sampleLayer:
    Type: AWS::Serverless::LayerVersion
    Properties:
      ContentUri: >-
        .somod/serverless/functionLayers/somod-http-extension-test/myFunction
  somod-http-extensionfnB:
    Type: AWS::Serverless::LayerVersion
    Properties:
      ContentUri: >-
        ${dirPath}/.somod/serverless/functionLayers/@test/moduleB/somod-http-extension-fnB
  somod-http-extensionfnA:
    Type: AWS::Serverless::LayerVersion
    Properties:
      ContentUri: >-
        ${dirPath}/.somod/serverless/functionLayers/moduleA/somod-http-extension-fnA
