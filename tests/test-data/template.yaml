AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Globals:
  Function:
    Runtime: nodejs16.x
    Handler: index.default
    Architectures:
      - arm64
Resources:
  HttpApiGateway:
    Type: AWS::Serverless::HttpApi
    Properties:
      CorsConfiguration:
        AllowOrigins:
          - "*"
  FunctionA:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: .somod/serverless/functions/moduleA/fnA
      Events:
        HttpApiEvent:
          Type: HttpApi
          Properties:
            Path: /user/{userId}
            Method: GET
            ApiId:
              Ref: r98a6ba03HttpApiGateway
      Layers:
        - Ref: sampleLayer
  FunctionB:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: .somod/serverless/functions/@test/moduleB/fnB
      Events:
        HttpApiEvent:
          Type: HttpApi
          Properties:
            Path: /user/{userId}
            Method: GET
            ApiId:
              Ref: r98a6ba03HttpApiGateway
      Layers:
        - Ref: sampleLayer
  sampleLayer:
    Type: AWS::Serverless::LayerVersion
    Properties:
      ContentUri: >-
        .somod/serverless/functionLayers/somod-http-extension-test/myFunction
